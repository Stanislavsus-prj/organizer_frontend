!function(){"use strict";function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var t=function(){function t(e,i,s,a,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=i,this.name=e,this.date=s,this.type=a,this.media_bodies=n,this.server=r}var i,s,a;return i=t,(s=[{key:"createElement",value:function(){var e=document.createElement("div");return e.classList.add("message"),e.dataset.id=this.id,e.innerHTML='<div class="message_header"></div>\n      <div class="message_body"></div>\n      <div class="message_footer"></div>',this.message_header=e.querySelector(".message_header"),this.message_body=e.querySelector(".message_body"),this.message_footer=e.querySelector(".message_footer"),this.messageHeader(),this.messageBody(),this.messageFooter(),e}},{key:"messageHeader",value:function(){var e=document.createElement("div");e.classList.add("tools"),e.innerHTML='<div class="message_header_img bin"></div>\n    <div class="message_header_img pin"></div>\n    <div class="message_header_img favorite_inactive"></div>',this.message_header.append(e)}},{key:"messageBody",value:function(){var e=this;switch(this.type){case"image":this.messageBodyImage();break;case"file":this.messageBodyFile();break;case"video":this.messageBodyVideo();break;case"audio":this.messageBodyAudio();break;default:var t=document.createElement("p");this.name.split(" ").reduce((function(i,s){if(/http[^ ]/.test(s)){var a=document.createElement("a");a.href=new URL(s).href,a.setAttribute("target","_blank"),a.style.display="block",a.innerHTML=s,a.dataset.id=e.id,t.innerHTML+=" ".concat(a.outerHTML),e.media_bodies.querySelector('[data-item="links"]').append(a.cloneNode(!0))}else t.innerHTML+=" ".concat(s)}),""),this.message_body.append(t)}}},{key:"messageBodyAudio",value:function(){var e=document.createElement("audio");e.classList.add("message_media"),e.setAttribute("controls",""),e.src="".concat(this.server).concat(this.name),this.message_body.append(e),this.message_body.dataset.id=this.id,this.media_bodies.querySelector('[data-item="audios"]').append(this.message_body.cloneNode(!0))}},{key:"messageBodyVideo",value:function(){var e=document.createElement("video");e.classList.add("message_media"),e.setAttribute("controls",""),e.src="".concat(this.server).concat(this.name),this.message_body.append(e),this.message_body.dataset.id=this.id,this.media_bodies.querySelector('[data-item="videos"]').append(this.message_body.cloneNode(!0))}},{key:"messageBodyImage",value:function(){var e=document.createElement("img");e.classList.add("message_media"),e.src="".concat(this.server).concat(this.name),e.innerHTML=this.name,this.message_body.append(e),this.message_body.dataset.id=this.id,this.media_bodies.querySelector('[data-item="images"]').append(this.message_body.cloneNode(!0))}},{key:"messageBodyFile",value:function(){var e=document.createElement("a");e.classList.add("message_file"),e.href="".concat(this.server).concat(this.name),e.innerHTML=this.name,this.message_body.append(e),this.message_body.dataset.id=this.id,this.media_bodies.querySelector('[data-item="files"]').append(this.message_body.cloneNode(!0))}},{key:"messageFooter",value:function(){var e=document.createElement("span");e.classList.add("date"),e.innerHTML=this.date,this.message_footer.append(e)}}])&&e(i.prototype,s),a&&e(i,a),Object.defineProperty(i,"prototype",{writable:!1}),t}();function i(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var s=function(){function e(t,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clip=t,this.chat_input=i,this.chat_footer=this.chat_input.parentElement,this.sending=s}var t,s,a;return t=e,(s=[{key:"start",value:function(){this.recorder.start(),this.recordStatus()}},{key:"stop",value:function(){this.recorder.stop(),clearInterval(this.timerInterval),this.stream.getTracks().forEach((function(e){return e.stop()})),this.backfromMediaInterface()}},{key:"recordStatus",value:function(){var e=this,t=0;this.status.innerText="Recording ".concat(t," sec"),this.timerInterval=setInterval((function(){t+=1,e.status.innerText="Recording ".concat(t," sec")}),1e3)}},{key:"record",value:function(e){var t=this;return new Promise((function(i,s){var a={audio:!0};t.blobType="audio/mpeg","video"===e&&(a.video=!0,t.blobType="video/mp4"),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(a).catch((function(){return s(new Error("Вы не предоставили доступ к запрашиваемым устройствам"))})).then((function(s){t.stream=s,t.recorder=new MediaRecorder(t.stream),t.typeMedia=e,t.mediaInterface(),t.chunks=[],t.recorder.addEventListener("dataavailable",(function(e){t.chunks.push(e.data)})),t.recorder.addEventListener("stop",(function(){i(new Blob(t.chunks,{type:t.blobType}))}))})):s(new Error("Ваш браузер не записывает аудио"))}))}},{key:"mediaInterface",value:function(){var e=this,t=document.createElement("div");t.classList.add("".concat(this.typeMedia,"_icon")),this.clip.replaceWith(t),this.status=document.createElement("div"),this.status.classList.add("mediaRecord_status"),this.status.innerText="".concat(this.typeMedia," waiting"),this.chat_input.replaceWith(this.status);var i=document.createElement("div");i.classList.add("close_mediaRecord"),this.sending.replaceWith(i),i.addEventListener("click",(function(){return e.backfromMediaInterface()}));var s=document.createElement("div");s.classList.add("mediaRecord_start"),s.addEventListener("click",(function(){return e.start()})),this.chat_footer.insertBefore(s,this.status);var a=document.createElement("div");a.classList.add("mediaRecord_stop"),a.addEventListener("click",(function(){return e.stop()})),this.chat_footer.insertBefore(a,i)}},{key:"backfromMediaInterface",value:function(){this.chat_footer.querySelector(".close_mediaRecord").replaceWith(this.sending),this.chat_footer.querySelector(".mediaRecord_status").replaceWith(this.chat_input),this.chat_footer.querySelector(".".concat(this.typeMedia,"_icon")).replaceWith(this.clip),this.chat_footer.querySelector(".mediaRecord_stop").remove(),this.chat_footer.querySelector(".mediaRecord_start").remove()}}])&&i(t.prototype,s),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.dropplace=this.element.querySelector(".dropplace"),this.chat_footer=this.element.querySelector(".chat_footer"),this.clip=this.element.querySelector(".clip"),this.chat_input=this.element.querySelector(".chat_input"),this.sending=this.element.querySelector(".sending"),this.getFile=this.getFile.bind(this),this.fileInterface=this.fileInterface.bind(this),this.dragoverVisible=this.dragoverVisible.bind(this),this.dragoverHidden=this.dragoverHidden.bind(this),this.backfromFileInterface=this.backfromFileInterface.bind(this)}var t,i,s;return t=e,(i=[{key:"init",value:function(){this.element.addEventListener("dragover",this.dragoverVisible),this.dropplace.addEventListener("dragleave",this.dragoverHidden),this.fileInterface()}},{key:"fileInterface",value:function(){var e=this,t=document.createElement("div");t.classList.add("close_file"),this.sending.replaceWith(t),t.addEventListener("click",(function(){return e.backfromFileInterface()}));var i=document.createElement("div");i.classList.add("icon_file"),this.clip.replaceWith(i),this.input_file=document.createElement("input"),this.input_file.classList.add("input_file"),this.input_file.type="file",this.chat_input.replaceWith(this.input_file)}},{key:"getFile",value:function(){var e=this;return new Promise((function(t){e.init(),e.dropplace.addEventListener("drop",(function(i){e.dragoverHidden(),e.backfromFileInterface(),t(i.dataTransfer.files[0])})),e.input_file.addEventListener("change",(function(i){i.preventDefault(),e.backfromFileInterface(),t(e.input_file.files[0])}))}))}},{key:"dragoverVisible",value:function(e){e.preventDefault(),this.dropplace.style.visibility="visible"}},{key:"dragoverHidden",value:function(e){e.preventDefault(),this.dropplace.style.visibility="hidden"}},{key:"backfromFileInterface",value:function(){null!=this.chat_footer.querySelector(".close_file")&&this.chat_footer.querySelector(".close_file").replaceWith(this.sending),null!=this.chat_footer.querySelector(".input_file")&&this.chat_footer.querySelector(".input_file").replaceWith(this.chat_input),null!=this.chat_footer.querySelector(".icon_file")&&this.chat_footer.querySelector(".icon_file").replaceWith(this.clip),this.element.removeEventListener("dragover",this.dragoverVisible),this.dropplace.removeEventListener("dragleave",this.dragoverHidden)}}])&&a(t.prototype,i),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,s;return t=e,(i=[{key:"getGeo",value:function(){var e=this;return new Promise((function(t,i){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(i){e.geoInterface(),e.geo.innerText="".concat(i.coords.latitude.toFixed(6),", ").concat(i.coords.longitude.toFixed(6)),t(e.geo)}),(function(){return i(new Error("Вы не предоставили доступ к координатам"))})):i(new Error("Ваш браузер не определяет координаты"))}))}},{key:"geoInterface",value:function(){this.geo=document.createElement("div"),this.geo.classList.add("geo_frame"),this.geo.classList.add("geo")}},{key:"geoMessage",value:function(e){var t=document.createElement("a");return t.classList.add("geo_mesg"),t.classList.add("geo"),t.innerText=e,t.setAttribute("href","https://yandex.ru/maps/?text=".concat(t.innerText)),t.setAttribute("target","_blank"),t}}])&&r(t.prototype,i),s&&r(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.server=t,this.wsServer=this.server.replace(/^http/i,"ws"),this.data={event:"load"},this.callbacks={},this.onOpen=this.onOpen.bind(this),this.onMessage=this.onMessage.bind(this)}var t,i,s;return t=e,(i=[{key:"init",value:function(){this.ws=new WebSocket(this.wsServer),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.callbacks.error),this.ws.addEventListener("close",this.callbacks.error)}},{key:"onOpen",value:function(){this.ws.send(JSON.stringify(this.data))}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);"load"===t.event&&this.callbacks.load(t.dB,t.favorites,t.position),"showMessage"===t.event&&this.callbacks.showMessage(t.id,t.message,t.date,t.geo),"showFile"===t.event&&this.callbacks.showMessage(t.id,t.message,t.date,t.geo,t.type),"deleteMessage"===t.event&&this.callbacks.deleteMessage(t.id),"favoriteAppend"===t.event&&this.callbacks.favoriteAppend(t.id),"favoriteDelete"===t.event&&this.callbacks.favoriteDelete(t.id),"appendPin"===t.event&&this.callbacks.pinAppend(t.id)}},{key:"send",value:function(e,t){if(1===this.ws.readyState)if(this.data={event:e,message:t},"text"===t.type||null==t.type)this.ws.send(JSON.stringify(this.data));else{var i=new FormData;i.append("date",t.date),i.append("body",t.body),i.append("type",t.type),i.append("name",t.name),i.append("geo",t.geo),this.sendFile(i)}else this.callbacks.error()}},{key:"sendFile",value:function(e){var t=this,i=new XMLHttpRequest;i.open("POST","".concat(this.server,"upload")),i.addEventListener("error",(function(){return t.callbacks.error()})),i.send(e)}}])&&c(t.prototype,i),s&&c(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function u(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var m=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.server=i,this.element=t,this.sidebar=this.element.querySelector(".sidebar"),this.chat_footer=this.element.querySelector(".chat_footer"),this.chat_body=this.element.querySelector(".chat_body"),this.dropplace=this.element.querySelector(".dropplace"),this.clip=this.element.querySelector(".clip"),this.sending=this.element.querySelector(".sending"),this.clip_body=this.element.querySelector(".clip_body"),this.messages=this.element.querySelector(".messages"),this.chat_input=this.element.querySelector(".chat_input"),this.pin_mesg=this.element.querySelector(".pin_mesg"),this.pin_content_body=this.element.querySelector(".pin_content_body"),this.close_pin=this.element.querySelector(".close_pin"),this.expand_pin=this.element.querySelector(".expand_pin"),this.clip_geo=this.element.querySelector(".clip_geo"),this.clip_file=this.element.querySelector(".clip_file"),this.clip_audio=this.element.querySelector(".clip_audio"),this.clip_video=this.element.querySelector(".clip_video"),this.media=this.element.nextElementSibling,this.media_title=this.media.querySelector(".media_title"),this.close_media=this.media.querySelector(".close_media"),this.media_body=this.media.querySelector(".media_body"),this.media_bodies=this.media.querySelector(".media_bodies"),this.media_body_favorites=this.media.querySelector(".media_body_favorites"),this.showMessage=this.showMessage.bind(this),this.pinAppend=this.pinAppend.bind(this),this.deleteMessage=this.deleteMessage.bind(this),this.favoriteAppend=this.favoriteAppend.bind(this),this.favoriteDelete=this.favoriteDelete.bind(this),this.renderMessages=this.renderMessages.bind(this),this.scrollBottom=this.scrollBottom.bind(this),this.lazyLoad=this.lazyLoad.bind(this),this.currentDate=new Date,this.messages.addEventListener("scroll",this.lazyLoad)}var i,a,r;return i=e,a=[{key:"init",value:function(){var e=this;this.sidebar.addEventListener("click",(function(){e.media.classList.toggle("media_active")})),this.media_body.addEventListener("click",(function(t){var i=t.target.parentElement;t.currentTarget===t.target.parentElement&&(i=t.target),e.media_title.textContent=i.textContent,e.media_body.classList.add("media_body_inactive");var s=i.dataset.item;e.media_bodies.querySelector('[data-item="'.concat(s,'"]')).classList.add("media_body_item_active")})),this.media_bodies.addEventListener("DOMNodeInserted",(function(t){var i=t.target.parentElement.dataset.item,s=e.media_body.querySelector('[data-item="'.concat(i,'"]')),a=!1;e.media_title.innerText===s.innerText&&(a=!0);var n=s.querySelector("span").textContent;s.querySelector("span").textContent=Number(n)+1,a&&(e.media_title.innerText=s.innerText)})),this.media_bodies.addEventListener("DOMNodeRemoved",(function(t){var i=t.target.parentElement.dataset.item,s=e.media_body.querySelector('[data-item="'.concat(i,'"]')),a=!1;e.media_title.innerText===s.innerText&&(a=!0);var n=s.querySelector("span").textContent;s.querySelector("span").textContent=Number(n)-1,a&&(e.media_title.innerText=s.innerText)})),this.close_media.addEventListener("click",(function(){e.media.querySelector(".media_body_item_active")?e.media.querySelector(".media_body_item_active").classList.remove("media_body_item_active"):e.media.classList.remove("media_active"),e.media_title.textContent="Shared media",e.media_body.classList.remove("media_body_inactive")})),this.clip.addEventListener("click",(function(){e.clip_body.classList.toggle("clip_active")})),this.sending.addEventListener("click",(function(){return e.send(e.chat_input.value)})),this.clip_geo.addEventListener("click",(function(){e.chat_footer.querySelector(".geo_frame")?e.chat_footer.querySelector(".geo_frame").remove():e.geo(),e.clip_body.classList.remove("clip_active")})),this.clip_file.addEventListener("click",(function(){return e.attach()})),this.clip_audio.addEventListener("click",(function(){return e.record("audio")})),this.clip_video.addEventListener("click",(function(){return e.record("video")})),this.expand_pin.addEventListener("click",(function(){"30px"===e.pin_content_body.firstChild.style.height?(e.pin_content_body.firstChild.style.height="100px",e.pin_content_body.style.height="110px",e.expand_pin.style.transform="rotate(180deg)"):(e.pin_content_body.style.height="40px",e.pin_content_body.firstChild.style.height="30px",e.expand_pin.style.transform="rotate(0deg)")})),this.close_pin.addEventListener("click",(function(){e.pin_mesg.classList.remove("pin_mesg_active"),e.pin_content_body.innerHTML="",e.chat_body.style.flexDirection="column-reverse",e.pin_content_body.firstChild.style.height="30px",e.expand_pin.style.transform="rotate(0deg)"})),this.request=new d(this.server),this.request.callbacks={error:function(){throw Error("Ошибка соединения")},load:this.renderMessages,showMessage:this.showMessage,showFile:this.showMessage,pinAppend:this.pinAppend,deleteMessage:this.deleteMessage,favoriteAppend:this.favoriteAppend,favoriteDelete:this.favoriteDelete},this.request.init()}},{key:"record",value:function(e){var t=this;this.clip_body.classList.remove("clip_active"),new s(this.clip,this.chat_input,this.sending).record(e).then((function(e){return t.send(e)})).catch((function(e){return alert(e)}))}},{key:"attach",value:function(){var e=this;this.clip_body.classList.remove("clip_active"),new n(this.element).getFile().then((function(t){return e.send(t)}))}},{key:"send",value:function(e){var t={};if(e instanceof Blob){var i="";switch(e.type){case"image/jpeg":case"image/png":t.type="image";break;case"video/mp4":t.type="video",i="mp4";break;case"audio/mpeg":t.type="audio",i="mpeg";break;default:t.type="file"}t.body=e,e.name?t.name=e.name:t.name="".concat(this.currentDate.getTime(),".").concat(i)}else-1!==e.search(/\S/)&&(t.type="text",t.body=e);this.chat_footer.querySelector(".geo_frame")&&(t.geo=this.coordinates),0!==t.length&&(!t.hasOwnProperty("geo")&&(t.geo=""),t.date="".concat(this.checkValue(this.currentDate.getDate()),":").concat(this.checkValue(this.currentDate.getMonth()+1),":").concat(this.currentDate.getFullYear(),", ").concat(this.checkValue(this.currentDate.getHours()),":").concat(this.checkValue(this.currentDate.getMinutes())),this.request.send("showMessage",t)),this.chat_input.value=""}},{key:"checkValue",value:function(e){return 1===String(e).length?"0".concat(e):e}},{key:"pin",value:function(e,t){var i=this,s=e.querySelector(".pin");s.addEventListener("click",(function(){i.request.send("appendPin",{id:t})}))}},{key:"bin",value:function(e,t){var i=this,s=e.querySelector(".bin");s.addEventListener("click",(function(){i.request.send("deleteMessage",{id:t})}))}},{key:"favorite",value:function(e,t){var i=this,s=e.querySelector(".favorite_inactive"),a=document.createElement("div");a.classList.add("message_header_img"),a.classList.add("favorite_active"),s.addEventListener("click",(function(){s.replaceWith(a),a.addEventListener("click",(function(){a.replaceWith(s),i.request.send("favoriteDelete",t)})),i.request.send("favoriteAppend",t)}))}},{key:"geo",value:function(){var e=this,t=new o;t.getGeo().then((function(t){e.chat_footer.append(t),e.coordinates=t.innerText})).catch((function(e){return alert(e)}))}},{key:"showMessage",value:function(e,i,s,a){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"text",r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=new t(i,e,s,n,this.media_bodies,this.server).createElement();if(a&&c.querySelector(".message_body").append((new o).geoMessage(a)),this.pin(c,e),this.favorite(c,e),this.bin(c,e),this.messages.append(c),this.scrollBottom(this.messages.lastChild),r)return this.messages.lastChild}},{key:"pinAppend",value:function(e){this.pin_content_body.innerHTML="",this.chat_body.style.flexDirection="column",this.pin_mesg.classList.add("pin_mesg_active");var t=this.messages.querySelector('[data-id="'.concat(e,'"]')).querySelector(".message_body").firstChild;this.pin_content_body.append(t.cloneNode(!0))}},{key:"deleteMessage",value:function(e){this.messages.querySelector('[data-id="'.concat(e,'"]')).remove(),this.media_bodies.querySelector('[data-id="'.concat(e,'"]'))&&this.media_bodies.querySelectorAll('[data-id="'.concat(e,'"]')).forEach((function(e){return e.remove()}))}},{key:"favoriteAppend",value:function(e){var t=this.messages.querySelector('[data-id="'.concat(e,'"]')),i=t.querySelector(".message_body").firstChild.cloneNode(!0);i.dataset.id=t.dataset.id,this.media_body_favorites.append(i)}},{key:"favoriteDelete",value:function(e){var t,i=this.messages.querySelector('[data-id="'.concat(e,'"]')).querySelector(".message_body").firstChild,s=l(this.media_body_favorites.childNodes);try{for(s.s();!(t=s.n()).done;){var a=t.value;a.innerHTML===i.innerHTML&&a.remove()}}catch(e){s.e(e)}finally{s.f()}}},{key:"renderMessages",value:function(e,t,i){var s,a=l(e);try{for(a.s();!(s=a.n()).done;){var n=s.value,r=this.showMessage(n.id,n.message,n.date,n.geo,n.type,!0);-1!==t.indexOf(n.id)&&r.querySelector(".favorite_inactive").click(),n.pinned&&r.querySelector(".pin").click(),this.databasePosition||this.scrollBottom(r)}}catch(e){a.e(e)}finally{a.f()}this.databasePosition=i,this.databasePosition>0&&(this.upperMessageElement=this.messages.querySelector(".message:nth-child(3)"))}},{key:"scrollBottom",value:function(e){var t=this,i=e.querySelector(".message_body video");i||(i=e.querySelector(".message_body audio")),i&&i.addEventListener("loadeddata",(function(){t.messages.scrollTop=t.messages.scrollHeight-t.messages.getBoundingClientRect().height})),(i=e.querySelector(".message_body img"))&&i.addEventListener("load",(function(){t.messages.scrollTop=t.messages.scrollHeight-t.messages.getBoundingClientRect().height})),this.messages.scrollTop=this.messages.scrollHeight-this.messages.getBoundingClientRect().height}},{key:"lazyLoad",value:function(){this.databasePosition<=0||this.upperMessageElement&&this.upperMessageElement.getBoundingClientRect().bottom>0&&(this.upperMessageElement="",this.request.send("load",this.databasePosition))}}],a&&u(i.prototype,a),r&&u(i,r),Object.defineProperty(i,"prototype",{writable:!1}),e}();new m(document.querySelector(".chat"),"https://organizer-sham.onrender.com/").init()}();